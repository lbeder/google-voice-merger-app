import './CSVReader.scss';
import moment, { Moment } from 'moment';
import { ParseResult } from 'papaparse';
import { Button, Form, InputGroup } from 'react-bootstrap';
import { useCSVReader } from 'react-papaparse';

export class Entry {
  public originalPhoneNumber: string;
  public firstDate: Moment;
  public lastDate: Moment;
  public phoneNumber: string;
  public name: string;
  public match: number;
  public path: string;
  public size: number;

  // eslint-disable-next-line @typescript-eslint/no-explicit-any
  constructor(result: Record<string, any>) {
    this.originalPhoneNumber = result['phone number (html)'];
    this.firstDate = moment(result['first date']);
    this.lastDate = moment(result['last date']);
    this.phoneNumber = result['phone number (vcf)'];
    this.name = result['name (vcf)'];
    this.match = Number(result['match length']);
    this.path = result['path'];
    this.size = Number(result['file size']);
  }
}

interface IProps {
  onUploadAccepted: (results: ParseResult<string[]>) => void;
}

/* eslint-disable @typescript-eslint/no-explicit-any */
interface ICSVReaderProps {
  getRootProps: any;
  acceptedFile: any;
  ProgressBar: any;
}
/* eslint-enable @typescript-eslint/no-explicit-any */

const CSVReader = ({ onUploadAccepted }: IProps) => {
  const { CSVReader } = useCSVReader();

  return (
    <CSVReader config={{ header: true }} onUploadAccepted={onUploadAccepted}>
      {({ getRootProps, acceptedFile, ProgressBar }: ICSVReaderProps) => (
        <div className="csv-reader">
          <div>
            Please input the index.csv file that was previous generated by the{' '}
            <a href="https://github.com/lbeder/google-voice-merger" target="_blank" rel="noopener noreferrer">
              Google Voice Merger
            </a>{' '}
            tool:
          </div>
          <InputGroup>
            <Form.Control
              type="input"
              placeholder="CSV file"
              defaultValue={(acceptedFile && acceptedFile.name) || ''}
            />
            <Button {...getRootProps()}>Browse file</Button>

            <ProgressBar className="progress-bar" />
          </InputGroup>
        </div>
      )}
    </CSVReader>
  );
};

export default CSVReader;
